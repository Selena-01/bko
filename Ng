from collections import defaultdict
import math

# Step 1: Preprocess the corpus and create n-gram frequency tables
def generate_ngrams(tokens, n):
    return [tuple(tokens[i:i+n]) for i in range(len(tokens)-n+1)]

# Function to count n-grams
def count_ngrams(tokens, n):
    ngrams = generate_ngrams(tokens, n)
    freq = defaultdict(int)
    for gram in ngrams:
        freq[gram] += 1
    return freq

# Function to calculate n-gram probability
def calculate_ngram_probability(sentence, corpus, n):
    sentence_tokens = sentence.lower().split()
    corpus_tokens = corpus.lower().split()
    vocab = set(corpus_tokens)
    vocab_size = len(vocab)

    # Frequency counts
    ngram_counts = count_ngrams(corpus_tokens, n)
    n_minus1_counts = count_ngrams(corpus_tokens, n-1) if n > 1 else None

    # Generate sentence n-grams
    sentence_ngrams = generate_ngrams(sentence_tokens, n)
    prob_log_sum = 0

    for gram in sentence_ngrams:
        count_ngram = ngram_counts[gram]

        if n == 1:   # Unigram
            total_unigrams = sum(ngram_counts.values())
            prob = (count_ngram + 1) / (total_unigrams + vocab_size)

        else:   # Bigram, Trigram...
            count_prefix = n_minus1_counts[gram[:-1]]
            prob = (count_ngram + 1) / (count_prefix + vocab_size)

        if prob == 0:
            print(f"Unseen n-gram {gram} -> Probability = 0")
            return 0

        prob_log_sum += math.log(prob)

    sentence_probability = math.exp(prob_log_sum)
    return sentence_probability


# MAIN EXECUTION
if __name__ == "__main__":
    print("=== N-gram Sentence Probability Calculator ===")

    # User-defined corpus and sentence
    user_corpus = input("Enter the corpus text: ")
    user_sentence = input("Enter a sentence to evaluate: ")
    n = int(input("Enter n for n-gram (e.g., 1=unigram, 2=bigram, 3=trigram): "))

    probability = calculate_ngram_probability(user_sentence, user_corpus, n)

    print(f"\nCalculated {n}-gram probability of the sentence:\n{user_sentence}\n\nProbability: {probability}")

#OUTPUT

Enter the corpus text:  Artificial intelligence is transforming industries. Machine learning models are increasingly capable and powerful. Natural language processing enables computers to understand human text and speech.
Enter a sentence to evaluate:  machine learning models are increasingly capable
Enter n for n-gram (e.g., 1=unigram, 2=bigram, 3=trigram):  3

Calculated 3-gram probability of the sentence:
machine learning models are increasingly capable

Probability: 4.82253086419753e-05
